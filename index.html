<!DOCTYPE html>
<html lang="fa">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>نمایش اطلاعات از Google Sheets</title>
    <style>
        table {
            width: 100%;
            border-collapse: collapse;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: center;
        }
        th {
            background-color: #f2f2f2;
        }
    </style>
</head>
<body>
    <div id="data-container">
        <table id="data-table">
            <thead>
                <tr>
                    <th>تاریخ</th>
                    <th>نام کاربری</th>
                    <th>بج نامبر</th>
                    <th>میزان پرداخت</th>
                </tr>
            </thead>
            <tbody id="results"></tbody>
        </table>
    </div>

    <script>
        const SHEET_URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vT8iGURYuLh2FqrlnZhYncz7AuUtN-nR8T1IAJDMAa6o9awn7jlmcGFWz9Wn8dKIxlSLqOBMxOL3vIe/pubhtml'; // لینک منتشر شده را اینجا قرار دهید

        async function fetchData() {
            const response = await fetch(SHEET_URL);
            const data = await response.text();
            const parsedData = new window.DOMParser().parseFromString(data, "text/html");
            const rows = parsedData.querySelectorAll("table tbody tr");
            let dataArray = [];

            // استخراج داده‌ها از ردیف‌ها
            for (let i = 1; i < rows.length; i++) {
                const cells = rows[i].querySelectorAll("td");
                const rowData = [];
                cells.forEach(cell => {
                    rowData.push(cell.innerText);
                });
                dataArray.push(rowData);
            }

            // مرتب‌سازی داده‌ها بر اساس تاریخ (فرض بر این است که تاریخ در ستون اول است)
            dataArray.sort((a, b) => new Date(b[0]) - new Date(a[0]));

            let resultsHtml = '';
            // فقط ردیف‌های 2 تا 5 را نمایش می‌دهیم
            for (let i = 0; i < Math.min(dataArray.length, 5); i++) {
                resultsHtml += '<tr>';
                dataArray[i].forEach(cell => {
                    resultsHtml += `<td>${cell}</td>`;
                });
                resultsHtml += '</tr>';
            }

            document.getElementById('results').innerHTML = resultsHtml;
        }

        // بارگذاری اولیه داده‌ها
        fetchData();

        // به‌روزرسانی داده‌ها هر 10 ثانیه
        setInterval(fetchData, 10000); // 10000 میلی‌ثانیه = 10 ثانیه
    </script>
</body>
</html>
